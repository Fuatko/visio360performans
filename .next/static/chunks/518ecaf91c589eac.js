(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},35960,e=>{"use strict";let t,r;var a=e.i(68834);let s=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>s(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>s(t)(e)}}},i=(0,a.create)()((t=e=>({user:null,isLoading:!0,setUser:t=>e({user:t,isLoading:!1}),setLoading:t=>e({isLoading:t}),logout:()=>e({user:null,isLoading:!1})}),r={name:"visio360-auth"},(e,a,i)=>{let l,o={storage:function(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var t;let a=e=>null===e?null:JSON.parse(e,void 0),s=null!=(t=r.getItem(e))?t:null;return s instanceof Promise?s.then(a):a(s)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...r},n=!1,d=0,u=new Set,m=new Set,c=o.storage;if(!c)return t((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),e(...t)},a,i);let h=()=>{let e=o.partialize({...a()});return c.setItem(o.name,{state:e,version:o.version})},x=i.setState;i.setState=(e,t)=>(x(e,t),h());let g=t((...t)=>(e(...t),h()),a,i);i.getInitialState=()=>g;let f=()=>{var t,r;if(!c)return;let i=++d;n=!1,u.forEach(e=>{var t;return e(null!=(t=a())?t:g)});let x=(null==(r=o.onRehydrateStorage)?void 0:r.call(o,null!=(t=a())?t:g))||void 0;return s(c.getItem.bind(c))(o.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===o.version)return[!1,e.state];else{if(o.migrate){let t=o.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(t=>{var r;if(i!==d)return;let[s,n]=t;if(e(l=o.merge(n,null!=(r=a())?r:g),!0),s)return h()}).then(()=>{i===d&&(null==x||x(l,void 0),l=a(),n=!0,m.forEach(e=>e(l)))}).catch(e=>{i===d&&(null==x||x(void 0,e))})};return i.persist={setOptions:e=>{o={...o,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>f(),hasHydrated:()=>n,onHydrate:e=>(u.add(e),()=>{u.delete(e)}),onFinishHydration:e=>(m.add(e),()=>{m.delete(e)})},o.skipHydration||f(),l||g}));e.s(["useAuthStore",0,i],35960)},18566,(e,t,r)=>{t.exports=e.r(76562)},72520,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>t],72520)},388,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566);e.i(16787);var s=e.i(19455),i=e.i(15288),l=e.i(73635),o=e.i(7471),n=e.i(35960),d=e.i(75157),u=e.i(75254);let m=(0,u.default)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),c=(0,u.default)("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);var h=e.i(31278),x=e.i(72520);let g=(0,u.default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);function f(){let e=(0,a.useRouter)(),{setUser:u}=(0,n.useAuthStore)(),[f,p]=(0,r.useState)("email"),[b,y]=(0,r.useState)(""),[v,w]=(0,r.useState)(""),[j,N]=(0,r.useState)(!1),[S,k]=(0,r.useState)(""),C=async e=>{if(e.preventDefault(),!b.trim())return void(0,l.toast)("Email adresi girin","error");N(!0);try{let{data:e,error:t}=await o.supabase.from("users").select("*").eq("email",b.toLowerCase().trim()).eq("status","active").single();if(t||!e){(0,l.toast)("Bu email adresi kayıtlı değil","error"),N(!1);return}let r=Math.floor(1e5+9e5*Math.random()).toString(),a=new Date(Date.now()+3e5).toISOString(),{error:s}=await o.supabase.from("otp_codes").insert({email:b.toLowerCase().trim(),code:r,expires_at:a,used:!1});if(s){(0,l.toast)("OTP oluşturma hatası","error"),N(!1);return}if(!(await fetch("/api/send-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to_email:b.toLowerCase().trim(),to_name:e.name,otp_code:r})})).ok)throw Error("Email gönderilemedi");k((0,d.maskEmail)(b)),p("otp"),(0,l.toast)("Doğrulama kodu gönderildi","success")}catch(e){console.error("OTP Error:",e),(0,l.toast)("Bir hata oluştu","error")}finally{N(!1)}},I=async t=>{if(t.preventDefault(),6!==v.length)return void(0,l.toast)("6 haneli kodu girin","error");N(!0);try{let{data:t,error:r}=await o.supabase.from("otp_codes").select("*").eq("email",b.toLowerCase().trim()).eq("code",v).eq("used",!1).gte("expires_at",new Date().toISOString()).order("created_at",{ascending:!1}).limit(1).single();if(r||!t){(0,l.toast)("Geçersiz veya süresi dolmuş kod","error"),N(!1);return}await o.supabase.from("otp_codes").update({used:!0}).eq("id",t.id);let{data:a,error:s}=await o.supabase.from("users").select("*, organizations(*)").eq("email",b.toLowerCase().trim()).single();if(s||!a){(0,l.toast)("Kullanıcı bulunamadı","error"),N(!1);return}u(a),(0,l.toast)("Giriş başarılı!","success"),"super_admin"===a.role||"org_admin"===a.role?e.push("/admin"):e.push("/dashboard")}catch(e){console.error("Verify Error:",e),(0,l.toast)("Doğrulama hatası","error")}finally{N(!1)}};return(0,t.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:[(0,t.jsx)(l.ToastContainer,{}),(0,t.jsxs)("div",{className:"w-full max-w-md",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-amber-400 to-amber-500 rounded-2xl shadow-lg shadow-amber-500/30 mb-4",children:(0,t.jsx)("span",{className:"text-2xl font-bold text-slate-900",children:"V"})}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-white",children:"VISIO 360°"}),(0,t.jsx)("p",{className:"text-blue-200 mt-1",children:"Performans Değerlendirme Sistemi"})]}),(0,t.jsx)(i.Card,{className:"backdrop-blur-sm bg-white/95",children:(0,t.jsx)(i.CardBody,{className:"p-8",children:"email"===f?(0,t.jsxs)("form",{onSubmit:C,children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Hoş Geldiniz"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm mb-6",children:"Email adresinize doğrulama kodu göndereceğiz"}),(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(m,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,t.jsx)("input",{type:"email",value:b,onChange:e=>y(e.target.value),placeholder:"email@example.com",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",disabled:j})]})}),(0,t.jsx)(s.Button,{type:"submit",className:"w-full",disabled:j,children:j?(0,t.jsx)(h.Loader2,{className:"w-5 h-5 animate-spin"}):(0,t.jsxs)(t.Fragment,{children:["Kod Gönder",(0,t.jsx)(x.ArrowRight,{className:"w-5 h-5"})]})})]}):(0,t.jsxs)("form",{onSubmit:I,children:[(0,t.jsxs)("button",{type:"button",onClick:()=>p("email"),className:"flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 mb-4",children:[(0,t.jsx)(g,{className:"w-4 h-4"}),"Geri"]}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Doğrulama Kodu"}),(0,t.jsxs)("p",{className:"text-gray-500 text-sm mb-6",children:[(0,t.jsx)("span",{className:"font-medium text-blue-600",children:S})," adresine gönderilen 6 haneli kodu girin"]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(c,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,t.jsx)("input",{type:"text",value:v,onChange:e=>w(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 text-center text-2xl tracking-[0.5em] font-mono",maxLength:6,disabled:j})]}),(0,t.jsx)("p",{className:"text-xs text-gray-400 mt-2 text-center",children:"Kod 5 dakika içinde geçerliliğini yitirir"})]}),(0,t.jsx)(s.Button,{type:"submit",className:"w-full",disabled:j||6!==v.length,children:j?(0,t.jsx)(h.Loader2,{className:"w-5 h-5 animate-spin"}):(0,t.jsxs)(t.Fragment,{children:["Giriş Yap",(0,t.jsx)(x.ArrowRight,{className:"w-5 h-5"})]})}),(0,t.jsx)("button",{type:"button",onClick:C,className:"w-full mt-4 text-sm text-gray-500 hover:text-blue-600",disabled:j,children:"Kodu tekrar gönder"})]})})}),(0,t.jsx)("p",{className:"text-center text-blue-200/60 text-sm mt-6",children:"© 2026 MFK Danışmanlık - VISIO 360°"})]})]})}e.s(["default",()=>f],388)}]);