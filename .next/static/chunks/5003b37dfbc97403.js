(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},20278,e=>{"use strict";let t=(0,e.i(75254).default)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);e.s(["Target",()=>t],20278)},18566,(e,t,a)=>{t.exports=e.r(76562)},84614,e=>{"use strict";let t=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>t],84614)},63059,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],63059)},37336,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566);e.i(16787);var r=e.i(15288),i=e.i(19455),l=e.i(87486),n=e.i(73635),d=e.i(7471),c=e.i(63059),o=e.i(75254);let m=(0,o.default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),u=(0,o.default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var h=e.i(31278),x=e.i(84614),g=e.i(20278);function b(){let e=(0,s.useParams)(),o=(0,s.useRouter)(),b=e.slug,[f,j]=(0,a.useState)(null),[v,y]=(0,a.useState)([]),[p,N]=(0,a.useState)({}),[w,_]=(0,a.useState)({}),[k,C]=(0,a.useState)(!0),[S,B]=(0,a.useState)(!1),[T,q]=(0,a.useState)(0);(0,a.useEffect)(()=>{D()},[b]);let D=async()=>{try{let e=d.supabase.from("evaluation_assignments").select(`
          *,
          evaluator:evaluator_id(name),
          target:target_id(name, department),
          evaluation_periods(name, status)
        `),{data:t}=await e.eq("slug",b).single();if(!t){let{data:a}=await e.eq("id",b).single();t=a}if(!t){(0,n.toast)("DeÄŸerlendirme bulunamadÄ±","error"),o.push("/dashboard/evaluations");return}if("completed"===t.status){(0,n.toast)("Bu deÄŸerlendirme zaten tamamlanmÄ±ÅŸ","info"),o.push("/dashboard/evaluations");return}if(t.evaluation_periods?.status!=="active"){(0,n.toast)("Bu deÄŸerlendirme dÃ¶nemi aktif deÄŸil","error"),o.push("/dashboard/evaluations");return}j(t);let{data:a}=await d.supabase.from("questions").select(`
          *,
          categories(
            name,
            main_categories(name, status)
          )
        `).order("order_num"),s=(a||[]).filter(e=>e.categories?.main_categories?.status==="active");y(s);let r=s.map(e=>e.id),{data:i}=await d.supabase.from("answers").select("*").in("question_id",r).order("order_num"),l={};(i||[]).forEach(e=>{l[e.question_id]||(l[e.question_id]=[]),l[e.question_id].push(e)}),N(l)}catch(e){console.error("Load error:",e),(0,n.toast)("Veri yÃ¼klenirken hata oluÅŸtu","error")}finally{C(!1)}},M=async()=>{if(!f)return;let e=v.filter(e=>!w[e.id]||0===w[e.id].length);if(e.length>0){(0,n.toast)(`${e.length} soru cevaplanmamÄ±ÅŸ`,"error"),q(v.findIndex(e=>!w[e.id]||0===w[e.id].length));return}B(!0);try{let e=v.map(e=>{let t=w[e.id]||[],a=(p[e.id]||[]).filter(e=>t.includes(e.id)),s=a.reduce((e,t)=>e+t.std_score,0)/a.length||0,r=a.reduce((e,t)=>e+t.reel_score,0)/a.length||0;return{assignment_id:f.id,question_id:e.id,answer_ids:t,std_score:s,reel_score:r,category_name:e.categories?.name||null}}),{error:t}=await d.supabase.from("evaluation_responses").insert(e);if(t)throw t;let{error:a}=await d.supabase.from("evaluation_assignments").update({status:"completed",completed_at:new Date().toISOString()}).eq("id",f.id);if(a)throw a;(0,n.toast)("DeÄŸerlendirme baÅŸarÄ±yla kaydedildi! ðŸŽ‰","success"),setTimeout(()=>{o.push("/dashboard/evaluations")},1500)}catch(e){console.error("Submit error:",e),(0,n.toast)(e.message||"KayÄ±t hatasÄ±","error")}finally{B(!1)}},$=v[T],z=$&&p[$.id]||[],O=$&&w[$.id]||[],R=v.length>0?Math.round(Object.keys(w).filter(e=>w[e].length>0).length/v.length*100):0,I=f?.evaluator_id===f?.target_id;return k?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:[(0,t.jsx)(n.ToastContainer,{}),(0,t.jsx)(h.Loader2,{className:"w-8 h-8 animate-spin text-blue-600"})]}):f&&0!==v.length?(0,t.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 px-4",children:[(0,t.jsx)(n.ToastContainer,{}),(0,t.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-14 h-14 bg-gradient-to-br from-amber-400 to-amber-500 rounded-2xl shadow-lg mb-4",children:(0,t.jsx)("span",{className:"text-xl font-bold text-slate-900",children:"V"})}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-white",children:"VISIO 360Â°"}),(0,t.jsx)("p",{className:"text-blue-200 mt-1",children:f.evaluation_periods?.name})]}),(0,t.jsx)(r.Card,{className:"mb-6",children:(0,t.jsx)(r.CardBody,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center ${I?"bg-blue-100 text-blue-600":"bg-amber-100 text-amber-600"}`,children:I?(0,t.jsx)(x.User,{className:"w-7 h-7"}):(0,t.jsx)(g.Target,{className:"w-7 h-7"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:I?"Ã–z DeÄŸerlendirme":"DeÄŸerlendirilen KiÅŸi"}),(0,t.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:f.target?.name}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:f.target?.department})]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)(l.Badge,{variant:I?"info":"default",children:I?"ðŸ”µ Ã–z DeÄŸerlendirme":"ðŸ‘¥ Peer DeÄŸerlendirme"})})]})})}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-white text-sm mb-2",children:[(0,t.jsxs)("span",{children:["Ä°lerleme: ",T+1," / ",v.length]}),(0,t.jsxs)("span",{children:["%",R," tamamlandÄ±"]})]}),(0,t.jsx)("div",{className:"bg-white/20 rounded-full h-2 overflow-hidden",children:(0,t.jsx)("div",{className:"bg-gradient-to-r from-amber-400 to-amber-500 h-full transition-all duration-300",style:{width:`${R}%`}})})]}),(0,t.jsxs)(r.Card,{className:"mb-6",children:[(0,t.jsx)(r.CardHeader,{className:"border-b border-gray-100",children:(0,t.jsxs)("div",{children:[(0,t.jsxs)(l.Badge,{variant:"gray",className:"mb-2",children:[$?.categories?.main_categories?.name," â€º ",$?.categories?.name]}),(0,t.jsxs)(r.CardTitle,{className:"text-lg",children:["Soru ",T+1]})]})}),(0,t.jsxs)(r.CardBody,{children:[(0,t.jsx)("p",{className:"text-gray-900 text-lg mb-6",children:$?.text}),(0,t.jsx)("div",{className:"space-y-3",children:z.map(e=>{let a=O.includes(e.id);return(0,t.jsx)("button",{onClick:()=>{var t,a;return t=$.id,a=e.id,void _(e=>({...e,[t]:[a]}))},className:`w-full p-4 rounded-xl border-2 text-left transition-all ${a?"border-blue-500 bg-blue-50 text-blue-900":"border-gray-200 hover:border-blue-300 hover:bg-gray-50"}`,children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${a?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:a&&(0,t.jsx)(u,{className:"w-4 h-4 text-white"})}),(0,t.jsx)("span",{className:"flex-1",children:e.text}),a&&(0,t.jsx)(l.Badge,{variant:"info",className:"ml-2",children:"SeÃ§ildi"})]})},e.id)})})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(i.Button,{variant:"secondary",onClick:()=>q(e=>Math.max(0,e-1)),disabled:0===T,children:[(0,t.jsx)(m,{className:"w-5 h-5"}),"Ã–nceki"]}),T===v.length-1?(0,t.jsx)(i.Button,{variant:"success",onClick:M,disabled:S,children:S?(0,t.jsx)(h.Loader2,{className:"w-5 h-5 animate-spin"}):(0,t.jsxs)(t.Fragment,{children:["GÃ¶nder",(0,t.jsx)(u,{className:"w-5 h-5"})]})}):(0,t.jsxs)(i.Button,{onClick:()=>q(e=>Math.min(v.length-1,e+1)),children:["Sonraki",(0,t.jsx)(c.ChevronRight,{className:"w-5 h-5"})]})]}),(0,t.jsxs)("div",{className:"mt-8",children:[(0,t.jsx)("p",{className:"text-white/60 text-sm text-center mb-3",children:"HÄ±zlÄ± GeÃ§iÅŸ"}),(0,t.jsx)("div",{className:"flex flex-wrap justify-center gap-2",children:v.map((e,a)=>{let s=w[e.id]&&w[e.id].length>0,r=a===T;return(0,t.jsx)("button",{onClick:()=>q(a),className:`w-10 h-10 rounded-lg font-medium text-sm transition-all ${r?"bg-amber-500 text-white":s?"bg-emerald-500 text-white":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:a+1},e.id)})})]})]})]}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:[(0,t.jsx)(n.ToastContainer,{}),(0,t.jsx)(r.Card,{className:"max-w-md",children:(0,t.jsxs)(r.CardBody,{className:"text-center py-12",children:[(0,t.jsx)("p",{className:"text-gray-500",children:"DeÄŸerlendirme bulunamadÄ± veya soru yok"}),(0,t.jsx)(i.Button,{className:"mt-4",onClick:()=>o.push("/dashboard/evaluations"),children:"Geri DÃ¶n"})]})})]})}e.s(["default",()=>b],37336)}]);